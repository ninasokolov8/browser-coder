# Dockerfile for running tests against the Browser Coder API
FROM node:20-alpine

WORKDIR /app

# Install dependencies for testing
RUN apk add --no-cache curl bash jq

# Copy package files
COPY package.json ./
RUN npm install --production=false

# Copy security module (new modular structure)
COPY security/ ./security/

# Copy tests folder for other tests
COPY tests/ ./tests/

# Make scripts executable
RUN chmod +x tests/run-tests.sh 2>/dev/null || true

# Default command runs security tests
CMD ["node", "security/run.mjs", "--server=http://api:3001"]
